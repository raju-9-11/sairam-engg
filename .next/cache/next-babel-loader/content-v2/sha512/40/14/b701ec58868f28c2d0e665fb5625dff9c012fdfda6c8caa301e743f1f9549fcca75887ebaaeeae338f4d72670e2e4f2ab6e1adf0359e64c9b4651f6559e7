{"ast":null,"code":"import _regeneratorRuntime from \"/home/pacman/Desktop/nextjs/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _objectWithoutProperties from \"/home/pacman/Desktop/nextjs/node_modules/next/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _asyncToGenerator from \"/home/pacman/Desktop/nextjs/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/pacman/Desktop/nextjs/lib/auth.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nimport React, { useState, useEffect, useContext, createContext } from 'react';\nimport Router from 'next/router';\nimport firebase from './firebase';\nimport { createUser } from './db';\nvar authContext = /*#__PURE__*/createContext();\nexport function AuthProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n  var auth = useFirebaseAuth();\n  return /*#__PURE__*/_jsxDEV(authContext.Provider, {\n    value: auth,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 10,\n    columnNumber: 10\n  }, this);\n}\n\n_s(AuthProvider, \"0F2maWCBqtBnPg5uxJOzptuh0jA=\", false, function () {\n  return [useFirebaseAuth];\n});\n\n_c = AuthProvider;\nexport var useAuth = function useAuth() {\n  _s2();\n\n  return useContext(authContext);\n};\n\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nfunction useFirebaseAuth() {\n  _s3();\n\n  var _useState = useState(null),\n      user = _useState[0],\n      setUser = _useState[1];\n\n  var _useState2 = useState(true),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var firestore = firebase.firestore();\n\n  var handleUser = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(rawUser) {\n      var _user, token, userWithoutToken;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              console.log('handleUser called', new Date(), rawUser);\n\n              if (!rawUser) {\n                _context.next = 12;\n                break;\n              }\n\n              _context.next = 4;\n              return formatUser(rawUser);\n\n            case 4:\n              _user = _context.sent;\n              token = _user.token, userWithoutToken = _objectWithoutProperties(_user, [\"token\"]);\n              createUser(_user.uid, userWithoutToken);\n              setUser(_user);\n              setLoading(false);\n              return _context.abrupt(\"return\", _user);\n\n            case 12:\n              setUser(false);\n              setLoading(false);\n              return _context.abrupt(\"return\", false);\n\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleUser(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var signupWithEmail = function signupWithEmail(email, password, firstName, lastName, redirect) {\n    firebase.auth().createUserWithEmailAndPassword(email, password).then(function (response) {\n      firestore.collection('users').doc(response.user.uid).set({\n        first_name: firstName,\n        last_name: lastName\n      });\n      handleUser(response.user);\n\n      if (redirect) {\n        Router.push(redirect);\n      }\n    });\n  };\n\n  var signinWithEmail = function signinWithEmail(email, password, redirect) {\n    setLoading(true);\n    return firebase.auth().signInWithEmailAndPassword(email, password).then(function (response) {\n      handleUser(response.user);\n\n      if (redirect) {\n        Router.push(redirect);\n      }\n    });\n  };\n\n  var signinWithGitHub = function signinWithGitHub(redirect) {\n    setLoading(true);\n    return firebase.auth().signInWithPopup(new firebase.auth.GithubAuthProvider()).then(function (response) {\n      handleUser(response.user);\n\n      if (redirect) {\n        Router.push(redirect);\n      }\n    });\n  };\n\n  var signinWithTwitter = function signinWithTwitter(redirect) {\n    setLoading(true);\n    return firebase.auth().signInWithPopup(new firebase.auth.TwitterAuthProvider()).then(function (response) {\n      handleUser(response.user);\n\n      if (redirect) {\n        Router.push(redirect);\n      }\n    });\n  };\n\n  var signinWithGoogle = function signinWithGoogle(redirect) {\n    setLoading(true);\n    return firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider()).then(function (response) {\n      handleUser(response.user);\n\n      if (redirect) {\n        Router.push(redirect);\n      }\n    });\n  };\n\n  var signout = function signout() {\n    return firebase.auth().signOut().then(function () {\n      return handleUser(false);\n    });\n  };\n\n  useEffect(function () {\n    var unsubscribe = firebase.auth().onIdTokenChanged(handleUser);\n    return function () {\n      return unsubscribe();\n    };\n  }, []); // useEffect(() => {\n  //   const interval = setInterval(async () => {\n  //     if (user) {\n  //       const token = await firebase\n  //         .auth()\n  //         .currentUser.getIdToken(/* forceRefresh */ true);\n  //       setUser(user);\n  //       console.log('refreshed token');\n  //     }\n  //   }, 30 * 60 * 1000 /*every 30min, assuming token expires every 1hr*/);\n  //   return () => clearInterval(interval);\n  // }, [user]); // needs to depend on user to have closure on a valid user object in callback fun\n\n  var getFreshToken = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var currentUser, token;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              console.log('getFreshToken called', new Date());\n              currentUser = firebase.auth().currentUser;\n\n              if (!currentUser) {\n                _context2.next = 9;\n                break;\n              }\n\n              _context2.next = 5;\n              return currentUser.getIdToken(false);\n\n            case 5:\n              token = _context2.sent;\n              return _context2.abrupt(\"return\", \"\".concat(token));\n\n            case 9:\n              return _context2.abrupt(\"return\", '');\n\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function getFreshToken() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return {\n    user: user,\n    loading: loading,\n    signinWithEmail: signinWithEmail,\n    signinWithGitHub: signinWithGitHub,\n    signinWithTwitter: signinWithTwitter,\n    signinWithGoogle: signinWithGoogle,\n    signout: signout,\n    getFreshToken: getFreshToken,\n    signupWithEmail: signupWithEmail\n  };\n} // const getStripeRole = async () => {\n//   await firebase.auth().currentUser.getIdToken(true);\n//   const decodedToken = await firebase.auth().currentUser.getIdTokenResult();\n//   return decodedToken.claims.stripeRole || 'free';\n// };\n\n\n_s3(useFirebaseAuth, \"NiO5z6JIqzX62LS5UWDgIqbZYyY=\");\n\nvar formatUser = /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(user) {\n    var decodedToken, token, expirationTime;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return user.getIdTokenResult(\n            /*forceRefresh*/\n            true);\n\n          case 2:\n            decodedToken = _context3.sent;\n            token = decodedToken.token, expirationTime = decodedToken.expirationTime; // console.log(token);\n\n            return _context3.abrupt(\"return\", {\n              uid: user.uid,\n              email: user.email,\n              name: user.displayName,\n              provider: user.providerData[0].providerId,\n              photoUrl: user.photoURL,\n              token: token,\n              expirationTime: expirationTime // stripeRole: await getStripeRole(),\n\n            });\n\n          case 5:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function formatUser(_x2) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/home/pacman/Desktop/nextjs/lib/auth.js"],"names":["React","useState","useEffect","useContext","createContext","Router","firebase","createUser","authContext","AuthProvider","children","auth","useFirebaseAuth","useAuth","user","setUser","loading","setLoading","firestore","handleUser","rawUser","console","log","Date","formatUser","token","userWithoutToken","uid","signupWithEmail","email","password","firstName","lastName","redirect","createUserWithEmailAndPassword","then","response","collection","doc","set","first_name","last_name","push","signinWithEmail","signInWithEmailAndPassword","signinWithGitHub","signInWithPopup","GithubAuthProvider","signinWithTwitter","TwitterAuthProvider","signinWithGoogle","GoogleAuthProvider","signout","signOut","unsubscribe","onIdTokenChanged","getFreshToken","currentUser","getIdToken","getIdTokenResult","decodedToken","expirationTime","name","displayName","provider","providerData","providerId","photoUrl","photoURL"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext, createContext } from 'react';\nimport Router from 'next/router';\nimport firebase from './firebase';\nimport { createUser } from './db';\n\nconst authContext = createContext();\n\nexport function AuthProvider({ children }) {\n  const auth = useFirebaseAuth();\n  return <authContext.Provider value={auth}>{children}</authContext.Provider>;\n}\n\nexport const useAuth = () => {\n  return useContext(authContext);\n};\n\nfunction useFirebaseAuth() {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  const firestore = firebase.firestore();\n\n  const handleUser = async (rawUser) => {\n    console.log('handleUser called', new Date(), rawUser);\n    if (rawUser) {\n      const user = await formatUser(rawUser);\n      const { token, ...userWithoutToken } = user;\n\n      createUser(user.uid, userWithoutToken);\n      setUser(user);\n\n      setLoading(false);\n      return user;\n    } else {\n      setUser(false);\n      setLoading(false);\n      return false;\n    }\n  };\n\n  const signupWithEmail = (email, password, firstName, lastName, redirect) => {\n    firebase\n      .auth()\n      .createUserWithEmailAndPassword(email, password)\n      .then((response) => {\n        firestore.collection('users').doc(response.user.uid)\n        .set({\n          first_name: firstName,\n          last_name: lastName,\n        })\n        handleUser(response.user);\n    \n        if (redirect) {\n          Router.push(redirect);\n        }\n    });\n  }\n\n  const signinWithEmail = (email, password, redirect) => {\n    setLoading(true);\n    return firebase\n      .auth()\n      .signInWithEmailAndPassword(email, password)\n      .then((response) => {\n        handleUser(response.user);\n\n        if (redirect) {\n          Router.push(redirect);\n        }\n      });\n  };\n\n  const signinWithGitHub = (redirect) => {\n    setLoading(true);\n    return firebase\n      .auth()\n      .signInWithPopup(new firebase.auth.GithubAuthProvider())\n      .then((response) => {\n        handleUser(response.user);\n\n        if (redirect) {\n          Router.push(redirect);\n        }\n      });\n  };\n\n  const signinWithTwitter = (redirect) => {\n    setLoading(true);\n    return firebase\n      .auth()\n      .signInWithPopup(new firebase.auth.TwitterAuthProvider())\n      .then((response) => {\n        handleUser(response.user);\n\n        if (redirect) {\n          Router.push(redirect);\n        }\n      });\n  };\n\n  const signinWithGoogle = (redirect) => {\n    setLoading(true);\n    return firebase\n      .auth()\n      .signInWithPopup(new firebase.auth.GoogleAuthProvider())\n      .then((response) => {\n        handleUser(response.user);\n\n        if (redirect) {\n          Router.push(redirect);\n        }\n      });\n  };\n\n  const signout = () => {\n    return firebase\n      .auth()\n      .signOut()\n      .then(() => handleUser(false));\n  };\n\n  useEffect(() => {\n    const unsubscribe = firebase.auth().onIdTokenChanged(handleUser);\n    return () => unsubscribe();\n  }, []);\n\n  // useEffect(() => {\n  //   const interval = setInterval(async () => {\n  //     if (user) {\n  //       const token = await firebase\n  //         .auth()\n  //         .currentUser.getIdToken(/* forceRefresh */ true);\n  //       setUser(user);\n  //       console.log('refreshed token');\n  //     }\n  //   }, 30 * 60 * 1000 /*every 30min, assuming token expires every 1hr*/);\n  //   return () => clearInterval(interval);\n  // }, [user]); // needs to depend on user to have closure on a valid user object in callback fun\n\n  const getFreshToken = async () => {\n    console.log('getFreshToken called', new Date());\n    const currentUser = firebase.auth().currentUser;\n    if (currentUser) {\n      const token = await currentUser.getIdToken(false);\n      return `${token}`;\n    } else {\n      return '';\n    }\n  };\n\n  return {\n    user,\n    loading,\n    signinWithEmail,\n    signinWithGitHub,\n    signinWithTwitter,\n    signinWithGoogle,\n    signout,\n    getFreshToken,\n    signupWithEmail\n  };\n}\n\n// const getStripeRole = async () => {\n//   await firebase.auth().currentUser.getIdToken(true);\n//   const decodedToken = await firebase.auth().currentUser.getIdTokenResult();\n//   return decodedToken.claims.stripeRole || 'free';\n// };\n\nconst formatUser = async (user) => {\n  // const token = await user.getIdToken(/* forceRefresh */ true);\n  const decodedToken = await user.getIdTokenResult(/*forceRefresh*/ true);\n  const { token, expirationTime } = decodedToken;\n  // console.log(token);\n  return {\n    uid: user.uid,\n    email: user.email,\n    name: user.displayName,\n    provider: user.providerData[0].providerId,\n    photoUrl: user.photoURL,\n    token,\n    expirationTime,\n    // stripeRole: await getStripeRole(),\n  };\n};"]},"metadata":{},"sourceType":"module"}